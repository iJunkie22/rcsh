#!/bin/bash
# Written by iJunkie22
# You can find more scripts (console-based and GUI-based) on my GitHub page @ https://github.com/iJunkie22
# This is for generating a backup preset script for KDE's KConfig files
# If you have an issue or just some feedback, contact me on GitHub or Twitter @iJunkie22
# Remember you will need to make the output file executable!
rcsh_convert () {
sed -e '/^\[/s:\[:--group \":g' -e '/^--group/s:\]:\" :g' -e '/^--group\|^$/! i\--key "' | awk 'BEGIN{ORS=""};{print};$0!="--key \""{k=$0;print"\n"}' | sed -e '/^--key/s/=/\" \"/1' | awk -F " " '$1=="--group"{q=$0};$1=="--key"{print q$0"\"";next}'
}

rcsh_blank_convert () {
sed -e '/^\[/s:\[:--group \":g' -e '/^--group/s:\]:\" :g' -e '/^--group\|^$/! i\--key "' | awk 'BEGIN{ORS=""};{print};$0!="--key \""{k=$0;print"\n"}' | (while read line;do echo "${line%%=*}";done)| awk -F " " '$1=="--group"{q=$0};$1=="--key"{print q" "$0"\" \"\"";next}'
}

infile=$2
outrc=$3
if [ -z $3 ]
then
outrc=${infile##*/}
fi

if [[ ${1} == --blank ]]
then
(printf '#!/bin/bash\n# Script generated by rcsh by iJunkie22\n';
cat "$infile" | rcsh_blank_convert | (while read line; do echo -e "kwriteconfig --file \"$outrc\" $line"; done)
printf 'exit\n') > "$infile.sh"
exit
fi

if [[ ${1} == --backup ]]
then
(printf '#!/bin/bash\n# Script generated by rcsh by iJunkie22\n';
cat "$infile" | rcsh_convert | (while read line; do echo -e "kwriteconfig --file \"$outrc\" $line"; done)
printf 'exit\n') > "$infile.sh"
exit
fi

printf 'Usage: rcsh [option] [infile] [target rc]\nOptions: You must choose one of the two options:\n\t--backup\tGenerates a script that will generate a mirror copy (useful for sharing setting presets) \n\t--blank \tGenerates a script that will generate a blank copy of an rc file\n\nIf [targetrc] is not specified, will use basename of input file\n\n========rcsh========\nKDE rc preset script generator\nWritten by iJunkie22 ~ <https://github.com/iJunkie22>\n'
exit